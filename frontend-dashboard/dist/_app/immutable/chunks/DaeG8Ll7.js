const d="http://localhost:8080/realms/ds-2025-realm/protocol/openid-connect/token",p="grupo-06",h="8dc00e75-ccea-4d1a-be3d-b586733e256c";async function i(e=fetch){const a=new URLSearchParams;a.append("grant_type","client_credentials"),a.append("client_id",p),a.append("client_secret",h);try{const t=await e(d,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a});if(!t.ok)throw new Error(`Error al obtener token de Keycloak: ${t.statusText}`);return(await t.json()).access_token}catch(t){throw console.error("Fallo grave en autenticación:",t),t}}async function u(e=fetch,a=null){const t=await i(e);let o="undefined/dashboard/shipment-status-distribution";a&&(o+=`?limit=${a}`);const r=await e(o,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw new Error(`Error al obtener la distribución de estados: ${r.statusText}`);return await r.json()}async function w(e,a=1,t=fetch){if(e.length<2)return Promise.resolve([]);const o=await i(t),c=`undefined/locality?${new URLSearchParams({locality_name:e,limit:"20",page:a.toString()}).toString()}`,n=await t(c,{headers:{Authorization:`Bearer ${o}`}});if(!n.ok)throw new Error(`Error al buscar localidades: ${n.statusText}`);return await n.json()}async function l(e,a=fetch){const t=await i(a),o=await a("undefined/shipping",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)});if(console.log(e),!o.ok){const r=new Error(`Failed to create shipment: ${o.statusText}`);throw r.response=o,r}return await o.json()}async function m(e=fetch){const a=await i(e),t=await e("undefined/shipping/transport-methods",{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error(`Error al obtener los métodos de transporte: ${t.statusText}`);return(await t.json()).transport_methods}async function S(e=1,a=10,t,o=fetch){const r=new URLSearchParams({page:e.toString(),pageSize:a.toString()});t.id&&r.append("id",t.id),t.city&&r.append("city",t.city),t.status&&r.append("status",t.status),t.startDate&&r.append("startDate",t.startDate),t.endDate&&r.append("endDate",t.endDate);const c=`undefined/dashboard/shipments?${r.toString()}`;try{const n=await i(o),s=await o(c,{headers:{Authorization:`Bearer ${n}`}});if(!s.ok)throw(s.status===401||s.status===403)&&console.error("¡Error de Autenticación! El token fue rechazado por la API.",s.statusText),new Error(`Failed to fetch dashboard shipments: ${s.statusText}`);return await s.json()}catch(n){throw console.error("Error en getDashboardShipments:",n),n}}async function E(e,a=fetch){const t=await a(`undefined/shipping/${e}`);if(!t.ok){if(t.status===404)return;throw new Error(`Failed to fetch shipment ${e}: ${t.statusText}`)}return await t.json()}async function $(e,a,t,o=fetch){const r=await i(o),c=`undefined/shipments/${e}/status`,n=await o(c,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({new_status:a,message:t})});if(!n.ok){const s=await n.text();throw new Error(`Failed to update shipment status: ${n.statusText} - ${s}`)}return!0}export{m as a,E as b,l as c,S as d,u as g,w as s,$ as u};
