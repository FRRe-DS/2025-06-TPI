import"../chunks/DsnmJJEf.js";import"../chunks/BfMTlK6c.js";import{c as Ke,o as Qe}from"../chunks/BGtgH5ej.js";import{p as Re,x as e,b as Be,ae as o,ad as l,af as r,O as c,ah as t,u as X,ai as Pe,ac as H,aI as De,a9 as We,y as Xe}from"../chunks/BCZT5Dbg.js";import{e as M,s as Y}from"../chunks/CLcpye_t.js";import{i as y}from"../chunks/njmLvgol.js";import{e as Ce,i as $e}from"../chunks/CLhoNAXF.js";import{f as v,a as i,c as Fe,t as Ne}from"../chunks/BpGtaleV.js";import{r as I,s as ue}from"../chunks/BCGdHO_y.js";import{s as Ye}from"../chunks/Bm2xQnLq.js";import{b as B,a as ea}from"../chunks/zfcsrDtj.js";import{p as aa}from"../chunks/D4Caz1gY.js";import{i as Oe}from"../chunks/Ck-BG2pa.js";import{s as ra,a as ta,c as sa}from"../chunks/DaeG8Ll7.js";import{g as la}from"../chunks/iSigOcxx.js";import{p as oa}from"../chunks/BboO_tbj.js";import{I as Ae}from"../chunks/BAVLDn9j.js";var ia=v('<li class="disabled svelte-14jh48p">Buscando...</li>'),na=v('<li class="disabled svelte-14jh48p">No se encontraron resultados.</li>'),ca=v('<li role="button" tabindex="0" class="svelte-14jh48p"> <!></li>'),va=v('<li class="disabled svelte-14jh48p">Cargando más...</li>'),da=v("<!> <!>",1),ma=v('<ul class="dropdown svelte-14jh48p"><!></ul>'),pa=v('<div class="combobox-container svelte-14jh48p"><input type="text" placeholder="Escriba para buscar una localidad..." class="svelte-14jh48p"/> <!></div>');function ua(_e,oe){Re(oe,!1),oa(oe,"selectedLocality",8,void 0);let f=c(""),n=c([]),x=c(!1),b=c(!1),U,T=1,Z=!0;const F=20,h=Ke();async function E(u=!1){if(e(f).length<2){r(n,[]);return}u||(T=1,r(n,[]),Z=!0),r(b,!0);try{const m=await ra(e(f),T);r(n,[...e(n),...m]),m.length<F&&(Z=!1)}catch(m){console.error("Error al buscar localidades:",m),r(n,[])}finally{r(b,!1)}}function z(){if(r(x,!0),clearTimeout(U),!e(f)){r(x,!1),r(n,[]);return}U=setTimeout(()=>{E(!1)},300)}function j(u){r(f,u.locality_name),r(x,!1),h("select",{locality:u})}function ie(u){const m=u.target;m.scrollTop+m.clientHeight>=m.scrollHeight-20&&Z&&!e(b)&&(T++,E(!0))}function J(){e(f)&&r(x,!0)}function ne(){setTimeout(()=>{r(x,!1)},200)}Oe();var k=pa(),_=o(k);I(_);var fe=l(_,2);{var be=u=>{var m=ma(),K=o(m);{var ee=q=>{var D=ia();i(q,D)},ce=q=>{var D=Fe(),ve=Pe(D);{var ae=w=>{var N=na();i(w,N)},de=w=>{var N=da(),re=Pe(N);Ce(re,3,()=>e(n),(P,p)=>P.postal_code+P.locality_name+p,(P,p)=>{var $=ca(),Q=o($),ye=l(Q);{var te=A=>{var W=Ne();H(()=>Y(W,`(${e(p),X(()=>e(p).state_name)??""})`)),i(A,W)};y(ye,A=>{e(p),X(()=>e(p).state_name)&&A(te)})}t($),H(()=>Y(Q,`${e(p),X(()=>e(p).locality_name)??""} `)),M("mousedown",$,()=>j(e(p))),M("keydown",$,A=>A.key==="Enter"&&j(e(p))),i(P,$)});var he=l(re,2);{var ge=P=>{var p=va();i(P,p)};y(he,P=>{e(b),e(n),X(()=>e(b)&&e(n).length>0)&&P(ge)})}i(w,N)};y(ve,w=>{e(n),e(f),X(()=>e(n).length===0&&e(f).length>=2)?w(ae):w(de,!1)},!0)}i(q,D)};y(K,q=>{e(b),e(n),X(()=>e(b)&&e(n).length===0)?q(ee):q(ce,!1)})}t(m),M("scroll",m,ie),i(u,m)};y(fe,u=>{e(x)&&u(be)})}t(k),B(_,()=>e(f),u=>r(f,u)),M("input",_,z),M("focus",_,J),M("blur",_,ne),i(_e,k),Be()}var _a=v("<p>Cargando transportes...</p>"),fa=v('<p class="error-text svelte-pcmme6"> </p>'),ba=v('<label><input type="radio" name="transport_type" class="svelte-pcmme6"/> <!> <span> </span></label>'),ha=v('<div class="transport-options svelte-pcmme6"></div>'),ga=v('<button type="button" class="remove-btn svelte-pcmme6" title="Eliminar producto"><!></button>'),ya=v('<div class="product-item svelte-pcmme6"><div class="form-group svelte-pcmme6"><label class="svelte-pcmme6">Product ID</label> <input type="number" required class="svelte-pcmme6"/></div> <div class="form-group svelte-pcmme6"><label class="svelte-pcmme6">Cantidad</label> <input type="number" min="1" required class="svelte-pcmme6"/></div> <!></div>'),xa=v('<p class="message error-message svelte-pcmme6"> </p>'),Ea=v('<p class="message success-message svelte-pcmme6"> </p>'),qa=v('<span class="spinner svelte-pcmme6"></span> Creando...',1),wa=v('<div class="create-container svelte-pcmme6"><div class="header svelte-pcmme6"><h1 class="svelte-pcmme6">Crear Nuevo Pedido</h1> <a href="/dashboard/shipments" class="back-link svelte-pcmme6">← Volver al listado</a></div> <form><div class="details-grid svelte-pcmme6"><div class="grid-col svelte-pcmme6"><div class="info-card svelte-pcmme6"><h2 class="svelte-pcmme6">Información General</h2> <div class="form-grid svelte-pcmme6"><div class="form-group svelte-pcmme6"><label for="order_id" class="svelte-pcmme6">Order ID</label> <input type="number" id="order_id" required class="svelte-pcmme6"/></div> <div class="form-group svelte-pcmme6"><label for="user_id" class="svelte-pcmme6">User ID</label> <input type="number" id="user_id" required class="svelte-pcmme6"/></div> <div class="form-group full-width svelte-pcmme6"><label for="transport_type" class="svelte-pcmme6">Método de Transporte</label> <!></div></div></div> <div class="info-card svelte-pcmme6"><h2 class="svelte-pcmme6">Dirección de Entrega</h2> <div class="form-grid svelte-pcmme6"><div class="form-group full-width svelte-pcmme6"><label for="locality" class="svelte-pcmme6">Localidad</label> <!></div> <div class="form-group svelte-pcmme6"><label for="street" class="svelte-pcmme6">Calle</label> <input type="text" id="street" required class="svelte-pcmme6"/></div> <div class="form-group svelte-pcmme6"><label for="number" class="svelte-pcmme6">Número</label> <input type="number" id="number" required class="svelte-pcmme6"/></div> <div class="form-group svelte-pcmme6"><label for="postal_code" class="svelte-pcmme6">Código Postal</label> <input type="text" id="postal_code" readonly="" placeholder="Se autocompleta con la localidad" class="svelte-pcmme6"/></div></div></div></div> <div class="grid-col svelte-pcmme6"><div class="info-card svelte-pcmme6"><h2 class="svelte-pcmme6">Productos</h2> <div class="product-list svelte-pcmme6"></div> <button type="button" class="add-btn svelte-pcmme6">Añadir Producto</button></div> <div class="info-card svelte-pcmme6"><h2 class="svelte-pcmme6">Confirmar</h2> <!> <!> <button type="submit" class="submit-btn svelte-pcmme6"><!></button></div></div></div></form></div>');function Va(_e,oe){Re(oe,!1);const f=[];let n=c(),x=c(),b=c(""),U=c(),T=c(""),Z="",F=c("air"),h=c([{id:0,quantity:1}]),E=c(null),z=c(null),j=c(!1),ie,J=c([]),ne=c(!0),k=c(null);const _={"Road Transport":"road","Sea Freight":"sea","Rail Freight":"rail","Air Freight":"air"};Qe(async()=>{try{if(r(J,await ta()),e(J).length>0){const a=e(J)[0];r(F,_[a.name]||"air")}}catch(a){a instanceof Error?r(k,a.message):r(k,"Ocurrió un error inesperado al cargar los métodos de transporte.")}finally{r(ne,!1)}});function fe(a){const s=a.detail.locality;ie=s,Z=s.locality_name,r(T,s.postal_code)}function be(){r(h,[...e(h),{id:0,quantity:1}])}function u(a){r(h,e(h).filter((s,d)=>d!==a))}async function m(){if(r(E,null),r(z,null),r(j,!0),!ie){r(E,"Por favor, seleccione una localidad."),r(j,!1);return}const a={order_id:e(n),user_id:e(x),delivery_address:{street:e(b),number:e(U),postal_code:e(T),locality_name:Z},transport_type:e(F),products:e(h)};try{const s=await sa(a);r(z,`Pedido #${s.shipping_id} creado con éxito.`),setTimeout(()=>{la("/dashboard/shipments")},2e3)}catch(s){if(console.error("Error creating shipment:",s),s.response)try{const d=await s.response.json();r(E,`Error al crear el pedido: ${d.message||"Error desconocido del servidor."}`)}catch{r(E,"Error al procesar la respuesta del servidor.")}else r(E,"Error de red o CORS. Verifique la conexión y la configuración del servidor.")}finally{r(j,!1)}}Oe();var K=wa(),ee=l(o(K),2),ce=o(ee),q=o(ce),D=o(q),ve=l(o(D),2),ae=o(ve),de=l(o(ae),2);I(de),t(ae);var w=l(ae,2),N=l(o(w),2);I(N),t(w);var re=l(w,2),he=l(o(re),2);{var ge=a=>{var s=_a();i(a,s)},P=a=>{var s=Fe(),d=Pe(s);{var se=L=>{var g=fa(),O=o(g,!0);t(g),H(()=>Y(O,e(k))),i(L,g)},le=L=>{var g=ha();Ce(g,5,()=>e(J),$e,(O,S)=>{var R=ba();let me;var V=o(R);I(V);var C,G=l(V,2);{let we=Xe(()=>_[e(S).name]||"road");Ae(G,{get name(){return e(we)}})}var pe=l(G,2),Je=o(pe,!0);t(pe),t(R),H(()=>{me=Ye(R,1,"transport-option svelte-pcmme6",null,me,{selected:e(F)===_[e(S).name]}),C!==(C=_[e(S).name])&&(V.value=(V.__value=_[e(S).name])??""),Y(Je,e(S).name)}),ea(f,[],V,()=>(_[e(S).name],e(F)),we=>r(F,we)),i(O,R)}),t(g),i(L,g)};y(d,L=>{e(k)?L(se):L(le,!1)},!0)}i(a,s)};y(he,a=>{e(ne)?a(ge):a(P,!1)})}t(re),t(ve),t(D);var p=l(D,2),$=l(o(p),2),Q=o($),ye=l(o(Q),2);ua(ye,{$$events:{select:fe}}),t(Q);var te=l(Q,2),A=l(o(te),2);I(A),t(te);var W=l(te,2),Le=l(o(W),2);I(Le),t(W);var Se=l(W,2),Ie=l(o(Se),2);I(Ie),t(Se),t($),t(p),t(q);var Me=l(q,2),xe=o(Me),Ee=l(o(xe),2);Ce(Ee,5,()=>e(h),$e,(a,s,d)=>{var se=ya(),le=o(se),L=o(le);ue(L,"for",`product_id_${d}`);var g=l(L,2);I(g),ue(g,"id",`product_id_${d}`),t(le);var O=l(le,2),S=o(O);ue(S,"for",`quantity_${d}`);var R=l(S,2);I(R),ue(R,"id",`quantity_${d}`),t(O);var me=l(O,2);{var V=C=>{var G=ga(),pe=o(G);Ae(pe,{name:"trash"}),t(G),M("click",G,()=>u(d)),i(C,G)};y(me,C=>{e(h).length>1&&C(V)})}t(se),B(g,()=>e(s).id,C=>(e(s).id=C,De(()=>e(h)))),B(R,()=>e(s).quantity,C=>(e(s).quantity=C,De(()=>e(h)))),i(a,se)}),t(Ee);var Ve=l(Ee,2);t(xe);var Te=l(xe,2),je=l(o(Te),2);{var Ge=a=>{var s=xa(),d=o(s,!0);t(s),H(()=>Y(d,e(E))),i(a,s)};y(je,a=>{e(E)&&a(Ge)})}var ke=l(je,2);{var He=a=>{var s=Ea(),d=o(s,!0);t(s),H(()=>Y(d,e(z))),i(a,s)};y(ke,a=>{e(z)&&a(He)})}var qe=l(ke,2),Ue=o(qe);{var Ze=a=>{var s=qa();We(),i(a,s)},ze=a=>{var s=Ne("Crear Pedido");i(a,s)};y(Ue,a=>{e(j)?a(Ze):a(ze,!1)})}t(qe),t(Te),t(Me),t(ce),t(ee),t(K),H(()=>qe.disabled=e(j)),B(de,()=>e(n),a=>r(n,a)),B(N,()=>e(x),a=>r(x,a)),B(A,()=>e(b),a=>r(b,a)),B(Le,()=>e(U),a=>r(U,a)),B(Ie,()=>e(T),a=>r(T,a)),M("click",Ve,be),M("submit",ee,aa(m)),i(_e,K),Be()}export{Va as component};
